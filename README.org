#+BEGIN_HTML
<a href="https://ci.appveyor.com/project/bozenne/lmbreak"><img src="https://ci.appveyor.com/api/projects/status/github/bozenne/lmbreak?svg=true" alt="Build status"></a>
<a href="https://github.com/bozenne/lmbreak/actions"><img src="https://github.com/bozenne/lmbreak/workflows/r/badge.svg" alt="Build status"></a>
<a href="http://www.gnu.org/licenses/gpl-3.0.html"><img src="https://img.shields.io/badge/License-GPLv3-blue.svg" alt="License"></a>
#+END_HTML

#+BEGIN_SRC R :exports none :results output :session *R* :cache no
options(width = 100)
#+END_SRC

#+RESULTS:

* lmbreak: Linear Regression with Unknown Breakpoints

*lmbreak*: Fit linear regression with unknown breakpoints

** Installation

You can download the latest stable =GitHub= version using:
#+BEGIN_SRC R :exports both :eval never
library(remotes)
install_github("bozenne/lmbreak")
#+END_SRC

** Functionalities

To illustrate the functionnalities of the package we will consider the
following dataset:
#+BEGIN_SRC R :exports both :results output :session *R* :cache no
data(SDIpsilo, package = "lmbreak")
SDIpsilo <- SDIpsilo[SDIpsilo$type %in% c("noise","trailing") == FALSE,]
str(SDIpsilo)
#+END_SRC

#+RESULTS:
: 'data.frame':	326 obs. of  4 variables:
:  $ id   : Factor w/ 15 levels "1","2","3","4",..: 1 1 1 1 1 1 1 1 1 1 ...
:  $ time : num  0 20 40 60 80 100 120 160 180 200 ...
:  $ type : chr  "signal" "signal" "signal" "signal" ...
:  $ score: num  0 1 3 8 10 10 10 10 10 7 ...

where the experience of 15 individuals is monitored over time. To
start with consider the data of individual 2:
#+BEGIN_SRC R :exports both :results output :session *R* :cache no
SDIpsilo2 <- SDIpsilo[SDIpsilo$id==13,]
#+END_SRC

#+RESULTS:

We can model his experience using a breakpoint model:
- with 2 breakpoints and three slopes ("111")
- with 2 breakpoints: one slope, one plateau, one slope ("101")
- with 1 breakpoint: two slopes ("11")
#+BEGIN_SRC R :exports code :results silent :session *R* :cache no
e.XP111 <- lmbreak(score ~ 0 + bp(time, "111"), data = SDIpsilo2)
e.XP101 <- lmbreak(score ~ 0 + bp(time, "101"), data = SDIpsilo2)
e.XP11 <- lmbreak(score ~ 0 + bp(time, "11"), data = SDIpsilo2)
plot(e.XP111, ylim = c(0,10)) ## left panel
plot(e.XP101, ylim = c(0,10)) ## middle panel
plot(e.XP11, ylim = c(0,10)) ## right panel
#+END_SRC

#+END_SRC

#+BEGIN_SRC R :exports none :results output :session *R* :cache no
gg12 <- ggpubr::ggarrange(ggplot2::autoplot(e.XP111, ylim = c(0,10))$plot + ggplot2::ggtitle("Pattern 111"),
                          ggplot2::autoplot(e.XP101, ylim = c(0,10))$plot + ggplot2::ggtitle("Pattern 101"),
                          ggplot2::autoplot(e.XP11, ylim = c(0,10))$plot + ggplot2::ggtitle("Pattern 11"),
                          common.legend = TRUE, legend = "bottom", nrow = 1)
ggplot2::ggsave(gg12, width = 10, height = 4, file = "inst/figures/gg-indiv-example.png")
#+END_SRC

#+RESULTS:
: Advarselsbeskeder:
: 1: [1m[22mRemoved 4 rows containing missing values (`geom_point()`). 
: 2: [1m[22mRemoved 4 rows containing missing values (`geom_point()`). 
: 3: [1m[22mRemoved 4 rows containing missing values (`geom_point()`). 
: 4: [1m[22mRemoved 4 rows containing missing values (`geom_point()`).

#+BEGIN_HTML
<img src="./inst/figures/gg-indiv-example.png" title="101 pattern - patient 1" alt="101 pattern - patient 1" width="100%" style="display: block; margin: auto;" />
#+END_HTML



#+BEGIN_SRC R :exports code :results output :session *R* :cache no
e.XPall <- mlmbreak(score ~ 0 + bp(time, "101"), cluster = "id", data = SDIpsilo)
plot(e.XPall, ylim = c(0,10))
#+END_SRC

#+RESULTS:
:   |                                                  | 0 % ~calculating    |++++                                              | 7 % ~01s            |+++++++                                           | 13% ~01s            |++++++++++                                        | 20% ~01s            |++++++++++++++                                    | 27% ~01s            |+++++++++++++++++                                 | 33% ~01s            |++++++++++++++++++++                              | 40% ~01s            |++++++++++++++++++++++++                          | 47% ~01s            |+++++++++++++++++++++++++++                       | 53% ~01s            |++++++++++++++++++++++++++++++                    | 60% ~01s            |++++++++++++++++++++++++++++++++++                | 67% ~01s            |+++++++++++++++++++++++++++++++++++++             | 73% ~01s            |++++++++++++++++++++++++++++++++++++++++          | 80% ~00s            |++++++++++++++++++++++++++++++++++++++++++++      | 87% ~00s            |+++++++++++++++++++++++++++++++++++++++++++++++   | 93% ~00s            |++++++++++++++++++++++++++++++++++++++++++++++++++| 100% elapsed=02s
: Advarselsbesked:
: [1m[22mRemoved 89 rows containing missing values (`geom_point()`).

